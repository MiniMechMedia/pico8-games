pico-8 cartridge // http://www.pico-8.com
version 39
__lua__
--snowflake tweet                v0.1.0
--mini mech media


-- Not strictly necessary. Just needed if someone is re-running the cart
-- since the memory we are using for scratch work is persistent
memset(0x8000,0,0x7fff)
-- We make extensive use of peek as well, but we can use the @ shorthand
-- operator for that
o=poke
timestep_=0
-- Activate horizontal mirror mode (otherwise there are some pixelly artifacts)
o(0x5f2c,5)
-- Seed the automata by turning on the cell at 64,64
o(0xa040,1)
cls()
::_::
-- Stop growing when the snowflake looks nice
if(timestep_>54)goto _
-- We will use 2 buffers, A and B for tracking the present state and the next state
-- Buffers start at memory locations 0xc000 and 0x8000 respectively and have a length
-- of 128x128 = 16383 bytes. x,y values map onto the memory loc buffer+y*128+x
-- a and b will correspond to the current location within each buffer
-- 
-- Loop through the 128x128 grid. We will calculate the state of the
-- next timestep, copy that over to the current timestep buffer,
-- and draw the buffer in a single pass
for a=0,16383do
-- Get the y value of the current cell. Later will compute x=a%128 but
-- will inline the value since we don't need to reuse it
y=a\128
-- Apply the correct buffer offsets
b=a+0xc000
a+=0x8000
-- Calculate the number of neighbors the current cell has.
-- Because we are linearizing the access, a-128 is the memory location
-- of the cell offset by x=0,y=-1, a-127 is x=1,y=-1, etc.
-- Note that we only check 6 neighbors. By ignoring the x=1,y=1 and x=-1,y=-1
-- cell locations, we are inducing a triangular grid instead of a square grid.
-- See acknowledgements for a visual of this.
neighbors_=@(a-128)+@(a-127)+@(a+127)+@(a+128)+@(a-1)+@(a+1)
-- The core logic of the automata. Turn on a cell when it has
-- exactly one neighbor. Even though it might get more neighbors
-- in later timesteps, it will stay turned on
if(neighbors_==1)o(b,1)
-- If we simply display every cell that is on, it will still
-- look like a snowflake, but it will be very dense. It looks
-- much nicer when we only draw the cells that are on and that
-- have many neighbors. These cells are at the "core" of the snowflake
if(neighbors_>3and @b>0)--[[
-- If we naively draw the pixel at (x,y) we will get a distorted snowflake.
-- This is a consequence of how we pretended our square grid was a triangular grid.
-- The fix is to apply a shear transformation so we draw at (x+y/2-33,y) instead
]]pset(a%128+y/2-33,y,7)
-- Now let's copy the future state buffer to the current state buffer. We
-- could use memcpy after the loop is done, but that takes too many characters.
-- We can't copy b to a directly, since that would interfere with neighbor 
-- calculations in subsequent iterations of the loop. But we can get away
-- with copying the cell 1 away in the y direction since we don't need
-- it any more.
-- We have an edge case where we are corrupting the 128 memory locations
-- preceding 0x8000 (in the screen data region), and we are also failing to 
-- copy the last 128 memory locations of our buffer. But luckily it isn't 
-- noticeable since those values would always be 0 any way
o(a-128,@(b-128))
end
timestep_+=1
flip()
goto _


__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000077007700000000007700770000000000007700770000000000770077000000000000000000000000000000000000
00000000000000000000000000000000000077000700000000000700070000000000007000700000000000700077000000000000000000000000000000000000
00000000000000000000000000000000000007007000000000000700700000000000000700700000000000070070000000000000000000000000000000000000
00000000000000000000000000000000000000707000000000000070700000000000000707000000000000070700000000000000000000000000000000000000
00000000000000000000000000000000007000770000000000000077777700000000777777000000000000007700070000000000000000000000000000000000
00000000000000000000000000000000007777770000000000000007000000000000000070000000000000007777770000000000000000000000000000000000
00000000000000000000000000000000000000070000000000000070000000000000000007000000000000007000000000000000000000000000000000000000
00000000000000000000000000000000000000007070707070707070000000000000000007070707070707070000000000000000000000000000000000000000
00000000000000000000000000000000000000007700770077007777000000000000000077770077007700770000000000000000000000000000000000000000
00000000000000000000000000000000000000077700070007000700000000000000000000700070007000777000000000000000000000000000000000000000
00000000000000000000000000000000000000000700700007007000700000000000000700070070000700700000000000000000000000000000000000000000
00000000000000000000000000000000000000700070700000707000700000000000000700070700000707000700000000000000000000000000000000000000
00000000000000000000000000000000000000700077000000777777770000000000007777777700000077000700000000000000000000000000000000000000
00000000000000000000000000000000000007777777000000070000000000000000000000007000000077777770000000000000000000000000000000000000
00000000000000000000000000000000000000000007000000700000007000000000070000000700000070000000000000000000000000000000000000000000
00000000000000000000000000000000000070000000707070700000007000000000070000000707070700000007000000000000000000000000000000000000
00000000000000000000000000007000000070000000770077770000077700000000777000007777007700000007000000070000000000000000000000000000
00000000000000000000000000007700000777000007770007000000070000000000007000000070007770000077700000770000000000000000000000000000
00000000000000000000000000000700000007000000070070007000700070000007000700070007007000000070000000700000000000000000000000000000
00000000000000000000000000000070007000700070007070007000700070000007000700070007070007000700070007000000000000000000000000000000
00000000000000000000000000700070007000700070007700000000000000000000000000000000770007000700070007000700000000000000000000000000
00000000000000000000000000777777777777777777777700000000000000000000000000000000777777777777777777777700000000000000000000000000
00000000000000000000000000000700070007000700000700000000000000000000000000000000700000700070007000700000000000000000000000000000
00000000000000000000000000000700070007000700000070707070707070700707070707070707000000700070007000700000000000000000000000000000
00000000000000000000000000007000000070000000000077007700770077000077007700770077000000000007000000070000000000000000000000000000
00000000000000000000000000007000007770000077000777000700070007000070007000700077700077000007770000070000000000000000000000000000
00000000000000000000000000000000000700000000000007007000070070000007007000070070000000000000700000000000000000000000000000000000
00000000000000000000000000000000000700000000007000707000007070000007070000070700070000000000700000000000000000000000000000000000
00000000000000000000000000000000000000000000007000770000007777000077770000007700070000000000000000000000000000000000000000000000
00000000000000000000000000000000000077777700077777770000000700000000700000007777777000777777000000000000000000000000000000000000
00000000000000000000000000000000000007000000000000070000007000000000070000007000000000000070000000000000000000000000000000000000
00000000000000000000000000000000000007000000700000007070707000000000070707070000000700000070000000000000000000000000000000000000
00000000000000000000700070000000000000000000700000007700777700000000777700770000000700000000000000000007000700000000000000000000
00000000000000000000770070000000000000770007770000077700070000000000007000777000007770007700000000000007007700000000000000000000
00000000000000000000070700000000000000000000070000000700700070000007000700700000007000000000000000000000707000000000000000000000
00000000000000000000007700000000000000000070007000700070700070000007000707000700070007000000000000000000770000000000000000000000
00000000000000000070007000000000000000000070007000700077000000000000000077000700070007000000000000000000070007000000000000000000
00000000000000000077777700000000000000000777777777777777000000000000000077777777777777700000000000000000777777000000000000000000
00000000000000000000000707070707070700000000070007000007000000000000000070000070007000000000707070707070700000000000000000000000
00000000000000000000000077007700770070007000070007000000707070700707070700000070007000070007007700770077000000000000000000000000
00000000000000000000000070007000700000007000000000000000770077000077007700000000000000070000000700070007000000000000000000000000
00000000000000000000000777007000070000077700000000770007770007000070007770007700000000777000007000070077700000000000000000000000
00000000000000000000000007070000070000000707000000000000070070000007007000000000000070700000007000007070000000000000000000000000
00000000000000000000007000770000007000700077000000000070007070000007070007000000000077000700070000007700070000000000000000000000
00000000000000000000007000700000000000700070000000000070007700000000770007000000000007000700000000000700070000000000000000000000
00000000000000000000077777770000000007777777000000000777777700000000777777700000000077777770000000007777777000000000000000000000
00000000000000000000000000070707000000000007070700000000000700000000700000000000707070000000000070707000000000000000000000000000
00000000000000000000700000007700700070000000770070007000000070700707000000070007007700000007000700770000000700000000000000000000
00000000000070000000700000007000000070000000700000007000000077000077000000070000000700000007000000070000000700000007000000000000
00000000000077000007770000077700000777000007770000077700000777000077700000777000007770000077700000777000007770000077000000000000
00000000000007000000070000000700000007000000070000000700000007000070000000700000007000000070000000700000007000000070000000000000
00000000000000700070007000700070007000700070007000700070007000700700070007000700070007000700070007000700070007000700000000000000
00000000007000700070007000700070007000700070007000700070007000000000070007000700070007000700070007000700070007000700070000000000
00000000007777777777777777777777777777777777777777777777777777000077777777777777777777777777777777777777777777777777770000000000
00000000007000700070007000700070007000700070007000700070007000000000070007000700070007000700070007000700070007000700070000000000
00000000000000700070007000700070007000700070007000700070007000700700070007000700070007000700070007000700070007000700000000000000
00000000000007000000070000000700000007000000070000000700000007000070000000700000007000000070000000700000007000000070000000000000
00000000000077000007770000077700000777000007770000077700000777000077700000777000007770000077700000777000007770000077000000000000
00000000000070000000700000007000000070000000700000007000000077000077000000070000000700000007000000070000000700000007000000000000
00000000000000000000700000007700700070000000770070007000000070700707000000070007007700000007000700770000000700000000000000000000
00000000000000000000000000070707000000000007070700000000000700000000700000000000707070000000000070707000000000000000000000000000
00000000000000000000077777770000000007777777000000000777777700000000777777700000000077777770000000007777777000000000000000000000
00000000000000000000007000700000000000700070000000000070007700000000770007000000000007000700000000000700070000000000000000000000
00000000000000000000007000770000007000700077000000000070007070000007070007000000000077000700070000007700070000000000000000000000
00000000000000000000000007070000070000000707000000000000070070000007007000000000000070700000007000007070000000000000000000000000
00000000000000000000000777007000070000077700000000770007770007000070007770007700000000777000007000070077700000000000000000000000
00000000000000000000000070007000700000007000000000000000770077000077007700000000000000070000000700070007000000000000000000000000
00000000000000000000000077007700770070007000070007000000707070700707070700000070007000070007007700770077000000000000000000000000
00000000000000000000000707070707070700000000070007000007000000000000000070000070007000000000707070707070700000000000000000000000
00000000000000000077777700000000000000000777777777777777000000000000000077777777777777700000000000000000777777000000000000000000
00000000000000000070007000000000000000000070007000700077000000000000000077000700070007000000000000000000070007000000000000000000
00000000000000000000007700000000000000000070007000700070700070000007000707000700070007000000000000000000770000000000000000000000
00000000000000000000070700000000000000000000070000000700700070000007000700700000007000000000000000000000707000000000000000000000
00000000000000000000770070000000000000770007770000077700070000000000007000777000007770007700000000000007007700000000000000000000
00000000000000000000700070000000000000000000700000007700777700000000777700770000000700000000000000000007000700000000000000000000
00000000000000000000000000000000000007000000700000007070707000000000070707070000000700000070000000000000000000000000000000000000
00000000000000000000000000000000000007000000000000070000007000000000070000007000000000000070000000000000000000000000000000000000
00000000000000000000000000000000000077777700077777770000000700000000700000007777777000777777000000000000000000000000000000000000
00000000000000000000000000000000000000000000007000770000007777000077770000007700070000000000000000000000000000000000000000000000
00000000000000000000000000000000000700000000007000707000007070000007070000070700070000000000700000000000000000000000000000000000
00000000000000000000000000000000000700000000000007007000070070000007007000070070000000000000700000000000000000000000000000000000
00000000000000000000000000007000007770000077000777000700070007000070007000700077700077000007770000070000000000000000000000000000
00000000000000000000000000007000000070000000000077007700770077000077007700770077000000000007000000070000000000000000000000000000
00000000000000000000000000000700070007000700000070707070707070700707070707070707000000700070007000700000000000000000000000000000
00000000000000000000000000000700070007000700000700000000000000000000000000000000700000700070007000700000000000000000000000000000
00000000000000000000000000777777777777777777777700000000000000000000000000000000777777777777777777777700000000000000000000000000
00000000000000000000000000700070007000700070007700000000000000000000000000000000770007000700070007000700000000000000000000000000
00000000000000000000000000000070007000700070007070007000700070000007000700070007070007000700070007000000000000000000000000000000
00000000000000000000000000000700000007000000070070007000700070000007000700070007007000000070000000700000000000000000000000000000
00000000000000000000000000007700000777000007770007000000070000000000007000000070007770000077700000770000000000000000000000000000
00000000000000000000000000007000000070000000770077770000077700000000777000007777007700000007000000070000000000000000000000000000
00000000000000000000000000000000000070000000707070700000007000000000070000000707070700000007000000000000000000000000000000000000
00000000000000000000000000000000000000000007000000700000007000000000070000000700000070000000000000000000000000000000000000000000
00000000000000000000000000000000000007777777000000070000000000000000000000007000000077777770000000000000000000000000000000000000
00000000000000000000000000000000000000700077000000777777770000000000007777777700000077000700000000000000000000000000000000000000
00000000000000000000000000000000000000700070700000707000700000000000000700070700000707000700000000000000000000000000000000000000
00000000000000000000000000000000000000000700700007007000700000000000000700070070000700700000000000000000000000000000000000000000
00000000000000000000000000000000000000077700070007000700000000000000000000700070007000777000000000000000000000000000000000000000
00000000000000000000000000000000000000007700770077007777000000000000000077770077007700770000000000000000000000000000000000000000
00000000000000000000000000000000000000007070707070707070000000000000000007070707070707070000000000000000000000000000000000000000
00000000000000000000000000000000000000070000000000000070000000000000000007000000000000007000000000000000000000000000000000000000
00000000000000000000000000000000007777770000000000000007000000000000000070000000000000007777770000000000000000000000000000000000
00000000000000000000000000000000007000770000000000000077777700000000777777000000000000007700070000000000000000000000000000000000
00000000000000000000000000000000000000707000000000000070700000000000000707000000000000070700000000000000000000000000000000000000
00000000000000000000000000000000000007007000000000000700700000000000000700700000000000070070000000000000000000000000000000000000
00000000000000000000000000000000000077000700000000000700070000000000007000700000000000700077000000000000000000000000000000000000
00000000000000000000000000000000000077007700000000007700770000000000007700770000000000770077000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__meta:cart_info_start__
cart_type: tweet
# Embed: 750 x 680
game_name: Snowflake Tweet
# Leave blank to use game-name
game_slug: ''
jam_info: []
tagline: Creates a snowflake using cellular automata
time_left: ''
develop_time: ''
description: |
  Implements a cellular automata that produces a snowflake shape
controls: []
hints: ''
acknowledgements: |
  * Based on the snowflake cellular automata described in Stephen Wolfram's [A New Kind of Science](https://www.wolframscience.com/nks/p371--the-growth-of-crystals/)
  * Technique of transforming a square lattice to a triangular lattice borrowed from [Silvia Hao's blog post](https://community.wolfram.com/groups/-/m/t/235291)
to_do: []
version: 0.1.0
img_alt: A snowflake
about_extra: ''
pico_url: https://www.pico-8-edu.com/?c=AHB4YQGwAT3rweIb3P8A73D6A9z9AMeXr9A1QTJjiSd4gbjomuz8FzDBA2Rx6ZmBLiiLh3iEga4u8nQiKpPENXUVhO1tFwVvkGbdOzzCUSP1Sioeoh0iHRTUaVVdN1VPlCsL7cA7REFTZVlWZVmbNVVWaQ_X2kPXCIxnKEjTIku6k_6a6pMguMsBzXmDQXBWPHLiTjKZV3kWN5k7zkuPG_qj2ktD5XlFdV3VhqMzM1U1GTxCESR7A9nGkQsD6eBIVszWcRstVis7KgEXXrhXLIfpS3ThG0ytpd1w1924N7onNdBVVSY61ownh65ly-bYCo22a6TC6LGuMRO9kTAMBpqNsh_14_BOne4sDYTdSLwraVJeqDiwMLU9NTMQLFTFjHiJzFDRbwz4JA92hldWmsWBpaVocHh2SMxAvgw=&g=w-w-w-w1HQHw-w2Xw-w3Xw-w2HQH
number_players: [0]
__meta:cart_info_end__
