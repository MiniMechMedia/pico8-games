pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
--{GAMENAME}
--{AUTHORINFO} 

-- so could fit up to 12 images 

_img_formless_void = "◝◝ヲ○◝◝♥ト…\nミR。❎~O◝ユ`ュ\0¹ᶠ◝ワA▒²\0³░★<\0!◝ョまX⁴4◆QR$⁴$?◝つ\rBゃ¹▮」( そq²りᶠ◝Pヌ。A\t██░オニ\0⁴「Db9🐱⁸H○ナ░░🐱¥、Aᶠd2BA?TDフ⬆️░Hョaッりᶠュチ…)▮RkG@4⌂p-E□¥◀¥□゜ッaケ(ヌ@NWすFDヒUd&$Hむᶠ◜pCっJF█ELネ🅾️□E░●★ロを!¥#▥゜ろ=🐱□、る`ハ¥Dょ、セ‖けhウ³²pく&w#D$H○ニ♥ニ\t#🅾️`🐱□マT⁷う6C\0のし➡️□[□⧗\"⬅️⁴?X~p★、ろG⁸⁵Og@\"❎、セl9キ⧗B$😐GP◝くさ,/H☉}る▮□b、り➡️!dm\\pJXヌ◀D?☉q\r\r\n■ds@N\"\"きj■!:やル,PrHけ¹∧G░¹#▤~オミ☉░ユDFF🐱(t▒◀I4●tq(こ♥\nけˇし$AaッれチD'▮🅾️p⁵ A²¹ろN'⁴G⁙■#(■iコ◀G…ュく‖!@t⁸ヘっI⁸r█▥E▤⁙。⁴つ⁘ち░\t,⬅️#ル░░ヌ\"$A#웃ᵉヌ\"0マ■⁙³まHニ'u8■[ぬタ♥⁴ホ🅾️)□っュ!ム🐱⁙⌂➡️ア…@wきヒ➡️り\"BX¥\nそに¥Z▥xけFへ@ョaさCさ\t■⁘yG▮ヒDぬ∧  IらwZJノTっ⌂むE\tネゃ]ソ⬅️▮∧$D@★h!を☉ぬpB\"\"っᶠaウ\tj$さbD*ᵇさBれ⬆️ュ⧗そ^$★ ➡️ョˇ□!A4[&き%とR\rh…ナGハᵉ ∧Dきえ▮Nノ!ろ. Tの-➡️\"$ちヒ…ヒリエ6p&BNp🅾️dXhX▮c#Aセャ⁴ヌ%▶\"⬇️@✽bうの░*iᵉ$cル…\"N`웃🐱HHヌB◀、%Kる⁴⁸ん⁸ひˇ⧗ほ⁸q$pqt゜も&☉H¥ろ✽:➡️ヤ▮*S☉…I⁘'²p🅾️kK(\"タこっX!R➡️8²□GgPニ⁴D:のI░ヒDミKあまネ]\nAaホム░▤⁙▒dかひ6\"っ`ぬPの:Id☉●⌂MとRユうHュ゛²T★うY,CJ★,,8░ˇᶜ(あれA$☉★H웃cタゅRJ웃⁙'▮★☉▒\"ゃs\",I#ロ●しHヌ■I8⁴た,⁘░➡️gFたFNノt$⁘Qわ░□゜て🅾️!ん0\n\"$BっI\"N▮●∧hメRD&✽9し\"B▮⁴QヲるCそ\\、Bt웃ᵉ! G⁴&A%るK!Nノ[⁴²CTi。っラRE●ナ\nすそたD¥ᵉ◝⁸■に4$にd[⁘$YPh\tケ<ˇア웃⌂ヌᵇ■dADの▮C¹せm▮⧗aア:g²$きのA$Xyᶠカ&☉り▮あき1'チ⁸bオ▮ぬ、ら,●░HEHオ◝aaね⁴X…キ□9♥!、-⁴Lqᶜな-ホ³た-さろ}#スs#Bっ#[\n%H🐱、BA)▮Tル★け⁙░⁘B/pマ゜て%*HG□ Pw#ゃR■:♥R,!‖▒\"BCまhh~+8웃\"I9$░░)カe[りき,♥■くh…&▥²D♥◜lB⁴⁸q★‖◀¥■。\\⁙ラj█☉\t\"ケ…ュ!◝… ᵉB□‖、っシGッ★,:IP➡️ケ◆ゅ◀E➡️ぬE웃ね⁘ぬン,たᵉナ⬇️⁘ヌ\0LX(♪ろ;ˇ$!ャゅR⁴⁸4♪ᵉqさ=♥ネkした(*G2?レほ◀$▮CCそ@か▒ト■⁸🐱*▶▥$😐wᶠる゛BHh9➡️ま□sᵉ8たるV⬇️っ¥iけヲ⁘d4🅾️ニャるC7、ろF➡️⁴⬅️¹ま⁷⁷…ヌ@∧っRカdc▤}ᶠュひH∧Iケ7⁙Aら,🅾️lD➡️l★ロi゛っ゛C웃_チ░0⬆️ヒ★□8ね%GgHり!し6*B□゜Cヘw+웃◀\rQ(★$★HH…w█w\tるI⁙,⬅️⁘⬇️ラˇュCゃ_J□🐱ソH,H⬅️ s²Pe░▥n?」_ル🅾️ᵉし$h²$ᵉD@ア\t¹ね#HんDタaQノ?\t_ル▒わ*H ろ$DAPそ♥セ■4sろる7□$?」\\っ…◝!ろきの%\r\tRbNノ(ムうろ♥リᶠラ゜CBB$ヌ⁴⁴カ$➡️ろ🐱sd★d⬅️ろ◆ョPCそI]HJ…(░くろ★M$★\tふCJ▥と¥D●♥ヤᶠ!ュ\"D➡️⁸O■▮▥:♥⁸□ろし▒l🅾️ニくム▮◝ん!\"Ab⁵☉✽けゃ4▒く\0\"ᵇ¹ャBAᶠ%y\t#AIきˇaHk$T □▮ヒゃ²\0おっヌ゜ム,にソG⁘ち%⁴ホ …Mカ■□、\"⁘ ♥P◜!チにd{)#う★²2I\"$:☉☉¹◀⁴I□?「wᵉニュれレマ⁸★⁴h⁸た」¹8웃◀Hぬう¹#☉y\r⁴>♥ヤᵇᵇ#つ■⁵\0001\nE…B,░‖⁸~ラよX~R9♥pも⬆️⁵…4G□ 4HそDけ@ぬ…BBJマ、れホ゜░8➡️ア☉H²ャd★ ∧D\tPH○ユ➡️ケ8♥ネ\tろD…▒⁷¥I\t$4■⁸ヒ²HCョ♥…マ゜ノに-@G⬅️$★@(²…\tᵉく$I、るれ▤{ᵉaケな$qニ@&ら⁸Bt^▮<▒▮➡️⧗み゜CCCラ♥0オヘたメI⁙は!\0Hョさsᶠウ゜⬆️?Nき⁴\0I!³\0d★🐱H✽…➡️ノ◆ウ゜ひ▮ョdp☉■Q ‖⁸\tろ■BらXHs!ᶠ!くろ$9ˇヲるHフ⌂웃!!t\" ▒$Mオ▒り■#はゃ、れ웃]れホ_░な▮🐱I▮⬆️X□き□ゃ‖%りろ▮ラ、れ웃_ヲ$~▮⬅️□Dᵇ□C!⁴そY'5ᵉbᶠaケにウGオョニ:そ$⁴<$!▮2ᵉ■、ヌ▮C▥]れユ➡️ろ,<░♥*D*4F✽ね\"ᵇらK$s ~Rよヨゅュaムそ☉あ\"B、セ% 7H░¥⁸!◝🐱Gヤ)#スK@L♪$お■*Nっ☉も$웃ᶠヌ。れBれ◝「G&⁴∧Gtさ★&@웃²るるっJュさH○▮ッ▶☉⬅️▒ら,⌂░d🐱,➡️░もI⁶☉★?⁸○0ヌ゜😐,(I$ムY「I⁴キ⁴#$J◀Dモ\"Jキ?◜ユ(∧,⁸T8%⁴X█!ソ,⌂]⁵♥▮ッ。Cヘy²!わすHshE█p…ネ▤⬇️q▮ュさq\rᵉしw!ᵉノMKウこ웃、▒⁴⁵E$ぬ‖r■☉HCっhsᵉハ{ᵉˇ\r)ᵇ0YRゅMw¹!ᶠ\0!ム◆◜スM0#🐱5∧r■▒3░'ヌ4……ろ,?ワCぬVえ⁴ホ░4▥4すマ$●░▒「?⁸Hqᵉ!チ<ˇコ⬅️□L▒V⬅️ᵉも…⬆️p➡️\tdr⬇️♪■4Eˇろな!dI。Aᵉく4のD* コ'Q%♥r⁶:I⁴♪#Hヒ゜チ?=\tlきりh★*の□」!ム*ウ¹4Dˇ%w#◝ᶜ🅾️jHMゅラ⁴Ja‖Qノ▮ぬ'⁘な\t$そひ○…ョ …✽も▥★EG,ナ•Z⬆️。ヌ'♪ □◀D…➡️%~2>░♥「<サqセりBEG‖3%▥ヲ⁴▒)=¹ᶠキD♥★め⬆️ˇ❎░へENオA!そ⁘ぬマ🐱8*4I:…BGT}+ルッそ⁷6゛セ\"⁴チS🐱らHHN)dふ…∧せ◜\t^HオモXI(★くᵉ9け6み AンJナと=★ さ◆ゅG★,$♥➡️DIへYaろ▮▮Aす★♪$wち⁸ょI◀⁴゛Hオ★よxwmnRH…マA\t■⌂BdI!#AるK2$9\"¥\0➡️し~のまルそ➡️%ちニ$i」Iよ$アs$³●b□³「⬆️D⬆️w#Hュaテᶜ\"M\nひュd²⁸☉ねる%F☉q\"@ふIよ4➡️⁴Drかて<ろ\"%KeQ$vT\"⁴★Kむ▒8@ヒ\"8さ∧/あ!!*HAᵉき⬆️ね\"⁵りBXぬオヌ웃カ²W⁴みひ♥∧▮⁷3\"Oら\0?リ□HT웃d Mᶠら[\"8Aヒ●ソIろf⁴うり⁴@d⁸ ˇd~ルさ☉ょE&こヨヒ\nRb.ケ-、 ♥⁴モ□H…□Tˇろ,▮A+▒Q²と$⧗ワ*X웃Imˇ*█あ\tち²オ웃ᵉ■\\っBれユモ(⧗░\tb⁸!!ラ■!ろJあノ□れ✽へけBス☉ね□'0³ワ░@I*セ+■ンA☉!$⬅️るWなふニ▥\tᵇ」1□◀⧗゜😐🅾️!!),N/⁸ニ\"○A$웃)\\ひa(キ⁴⁸ふ,⁸%✽➡️aaヘHうしキBBD♥ニᶜ□%⁙G⁵Pヌ▒0⁘웃ARP☉XXs\t\"$➡️0I\n⌂~8'■⁶!2ノ%と⁘pR$🐱•⌂Iンれ∧b.☉I⁸のI#そ|`$p/◀み●TゃEHへQ⁴ゃ□Eりl□□5☉BI▶▥$…$!ヲり☉Dう⁸え➡️mNᵉ8」alI&⁶し$⌂$pn\"‖.☉⁴ソᶠゅ。∧D☉チ.Bょ、_▤うTJ☉コわ& $@nけく\nくD★J◆ロ⁘さD😐なこz⬇️I8B。く⁴➡️!$⬅️Qᵉノ\n⬆️D⌂ヌDI□⁸{\"ら웃ᵉろ ねnょQ カね,ち¥T♪$8…◆P⁴ 🐱!\0D◜$z▮`2p(のhハdrqi」➡️⁸…\t*Bn░⁸\n░……◝!BTた□けケ☉ね、ᵇ□まH%Y、‖'ね$A ぬA$ロGメᵇ ▮P,.へw□█+\tょ8i⁙■➡️さ⁸⬇️D!そ……マ゛Cヨ⁸%Dゃろ♪▮웃kR(⧗◀★%●らd@➡️t★¹aム◆ソ。@☉█░~)■ˇbt‖'ᵉo⁙n、4(★Dᵉキ□▮h4◆ヌ゛れ▤,⁸5Eもs pヌ⁴hu+リ∧:█Hi、Aᵉ!ョヌ▮ろくdo▶웃N」■□マ▤ネき□B*□DオH{ᶠウ◀゜░$¹#□Nᵇきた\"!'ち8ナ*ん▮★は░ヌ⁷キ,◆を゜チ4웃\0G²⁷7F☉⌂⧗\rな✽■⁘さ★□$□=…♥ャ⁴.\tᵉB$🅾️`!'$r★nヲeニ8ネえ'⁴Cン➡️ュBCヲノ¹∧%➡️シ=▶⬅️、□-ケく$Cロ➡️フq▮s#まsᵇ⁴8➡️▮⁙ˇZT\\⬆️\t😐2CD★⁸XHcトまフユフやヲレシニイ?웃クむT(p³GEネ❎ノ⬅️RD`マ。るる◜⁴トsヲyエお█\0"

byte_values = {
    ["0"] = 0, ["1"] = 1, ["2"] = 2, ["3"] = 3, ["4"] = 4,
    ["5"] = 5, ["6"] = 6, ["7"] = 7, ["8"] = 8, ["9"] = 9,
    ["a"] = 10, ["b"] = 11, ["c"] = 12, ["d"] = 13, ["e"] = 14, ["f"] = 15
}
function hex_to_byte(high_nibble, low_nibble)
    -- Combine the high and low nibbles to create a full byte value
    local byte_value = byte_values[high_nibble] + byte_values[low_nibble] * 16
    return byte_value
end

function escape_binary_str(s)
 local out=""
 for i=1,#s do
  local c  = sub(s,i,i)
  local nc = ord(s,i+1)
  local pr = (nc and nc>=48 and nc<=57) and "00" or ""
  local v=c
  if(c=="\"") v="\\\""
  if(c=="\\") v="\\\\"
  if(ord(c)==0) v="\\"..pr.."0"
  if(ord(c)==10) v="\\n"
  if(ord(c)==13) v="\\r"
  out..= v
 end
 return out
end

-- Define a function to parse the hex string and write it into memory
function hex_string_to_p8scii(hex_string)
	local ret = ''
    -- Iterate over the hexadecimal digits in the hex string two nibbles at a time
    for i = 1, #hex_string, 2 do
        -- Convert the hexadecimal nibbles to a byte value
        -- assert hex_string[i] != nil
        local byte_value = hex_to_byte(hex_string[i], hex_string[i+1])
        -- poke(mem_start + i/2, byte_value)
        ret ..= chr(byte_value)
    end
    return ret
end

-- local p8scii = escape_binary_str(hex_string_to_p8scii(image))
-- print(p8scii)
-- printh('"' .. p8scii .. '"', '@clip')

-- res = 0
function _init()
	poke(0x8000, ord(_img_formless_void, 1, #_img_formless_void))
	-- poke(0x0000, 1)
	-- poke(0x0002, 1)
	-- poke(0x0003, 1)
	px9_decomp(0,0,0x8000,sget,sset)
	-- memcpy(0, 0x8000, 0x1000)
	-- cstore()
end

function _draw()
	-- palt(0, false)
	spr(0,0,0,16,16)
	-- palt()
	-- print(res,7)
end


function
	px9_decomp(x0,y0,src,vget,vset)

	local function vlist_val(l, val)
		-- find position and move
		-- to head of the list

--[ 2-3x faster than block below
		local v,i=l[1],1
		while v!=val do
			i+=1
			v,l[i]=l[i],v
		end
		l[1]=val
--]]

--[[ 7 tokens smaller than above
		for i,v in ipairs(l) do
			if v==val then
				add(l,deli(l,i),1)
				return
			end
		end
--]]
	end

	-- bit cache is between 8 and
	-- 15 bits long with the next
	-- bits in these positions:
	--   0b0000.12345678...
	-- (1 is the next bit in the
	--   stream, 2 is the next bit
	--   after that, etc.
	--  0 is a literal zero)
	local cache,cache_bits=0,0
	function getval(bits)
		if cache_bits<8 then
			-- cache next 8 bits
			cache_bits+=8
			cache+=@src>>cache_bits
			src+=1
		end

		-- shift requested bits up
		-- into the integer slots
		cache<<=bits
		local val=cache&0xffff
		-- remove the integer bits
		cache^^=val
		cache_bits-=bits
		return val
	end

	-- get number plus n
	function gnp(n)
		local bits=0
		repeat
			bits+=1
			local vv=getval(bits)
			n+=vv
		until vv<(1<<bits)-1
		return n
	end

	-- header

	local
		w,h_1,      -- w,h-1
		eb,el,pr,
		x,y,
		splen,
		predict
		=
		gnp"1",gnp"0",
		gnp"1",{},{},
		0,0,
		0
		--,nil

	for i=1,gnp"1" do
		add(el,getval(eb))
	end
	for y=y0,y0+h_1 do
		for x=x0,x0+w-1 do
			splen-=1

			if(splen<1) then
				splen,predict=gnp"1",not predict
			end

			local a=y>y0 and vget(x,y-1) or 0

			-- create vlist if needed
			local l=pr[a] or {unpack(el)}
			pr[a]=l

			-- grab index from stream
			-- iff predicted, always 1

			local v=l[predict and 1 or gnp"2"]

			-- update predictions
			vlist_val(l, v)
			vlist_val(el, v)

			-- set
			vset(x,y,v)
		end
	end
end

__meta:cart_info_start__
cart_type: game
# Embed: 750 x 680
game_name: Game Template
# Leave blank to use game-name
game_slug: 
jam_info:
  - jam_name: TriJam
    jam_number: XX
    jam_url: null
    jam_theme: 'XXX'
tagline: XXXX
time_left: '0:0:0'
develop_time: ''
description: |
  
controls:
  - inputs: [X]
    desc: XXXX
hints: ''
acknowledgements: ''
to_do: []
version: 0.1.0
img_alt: XXXX
about_extra: ''
number_players: [1]
__meta:cart_info_end__


