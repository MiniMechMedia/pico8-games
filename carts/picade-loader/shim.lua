
-- Here
old_draw = _draw

function draw_header()
	local header_str = '0000000000000000000000006666666666666666666666666666666666666666666666666666666666666666666666666666666d0000000000000000000000000000000000000000000000006cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc10000000000000000000000000000000000000000000000006cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc10000000000000000000000000000000000000000000000006ccccccddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddcccccc10000000000000000000000000000000000000000000000006cccccd111111111111111111111111111111111111111111111111111111111111111111dccccc10000000000000000000000000000000000000000000000006ccccd1111111111111cccccc111cccccc111cccc1111ccc111ccccc111cccccc111111111dcccc10000000000000000000000000000000000000000000000006cccd11111111111111cc111cc1111cc1111cc11cc11cc1cc11cc11cc11cc11111111111111dccc10000000000000000000000000000000000000000000000006ccd111111111111111cc111cc1111cc111cc111111cc111cc1cc111cc1cc111111111111111dcc10000000000000000000000000000000000000000000000006ccd111111111111111cc111cc1111cc111cc111111cc111cc1cc111cc1ccccc111111111111dcc10000000000000000000000000000000000000000000000006cccd11111111111111cccccc11111cc111cc111111ccccccc1cc111cc1cc11111111111111dccc10000000000000000000000000000000000000000000000006ccccd1111111111111cc111111111cc1111cc11cc1cc111cc1cc11cc11cc1111111111111dcccc10000000000000000000000000000000000000000000000006cccccd111111111111cc1111111cccccc111cccc11cc111cc1ccccc111cccccc11111111dccccc10000000000000000000000000000000000000000000000006ccccccd1111111111111111111111111111111111111111111111111111111111111111dcccccc10000000000000000000000000000000000000000000000006cccccccddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddccccccc10000000000000000000000000000000000000000000000006cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc100000000000000000000000000000000000000000000000011111111cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc1111111500000000000000000000000000000000000000000000000045454545454545454545454545454545454545454545454545454545454545454545454545454542000000000000000000000000'
	local bottom = '0000000000000000000000006cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc10000000000000000000000000000000000000000000000006cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc1000000000000000000000000000000000000000000000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc000000000000000000000000000000000000000000000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc000000000000000000000000000000000000000000000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc000000000000000000000000000000000000000000000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc000000000000000000000000000000000000000000000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc000000000000000000000000000000000000000000000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000000000000000000055aaaa55cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc0000000000000000000000000000000000000000000000006a999946cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc000000000000000000000000000000000000000000000000a9999944cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000000000000000000099999444cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000000000000000000094994444cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc000000000000000000000000000000000000000000000000c444444ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc000000000000000000000000000000000000000000000000cc4444cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc000000000000000000000000000000000000000000000000cc6555cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000000000000000000011766511cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000000000000000000011566211cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000000000000000000011155111cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000000000000000000011111111cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000000000000000000011111111cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc000000000000000000000000000000000000000000000000ddddddddcccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000000000000000000011111111cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc00000000000000000000000000000000000000000000000011111111cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc000000000000000000000000000000000000000000000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc000000000000000000000000000000000000000000000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc000000000000000000000000000000000000000000000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc000000000000000000000000000000000000000000000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc000000000000000000000000000000000000000000000000cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc000000000000000000000000000000000000000000000000dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd000000000000000000000000000000000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000001111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'
	local mymap = {
		["0"] = 0,
		["1"] = 1,
		["2"] = 2,
		["3"] = 3,
		["4"] = 4,
		["5"] = 5,
		["6"] = 6,
		["7"] = 7,
		["8"] = 8,
		["9"] = 9,
		["a"] = 10,
		["b"] = 11,
		["c"] = 12,
		["d"] = 13,
		["e"] = 14,
		["f"] = 15,
	}
	local x = 0
	local y = 0
	for i = 1, #header_str do
		pset(x, y, mymap[header_str[i]])
		x += 1
		if x > 127 then
			x = 0
			y += 1
		end
	end

	x,y= 0,8*12-1
	for i = 1, #bottom do
		pset(x, y, mymap[bottom[i]])
		x += 1
		if x > 127 then
			x = 0
			y += 1
		end
	end
end

function _draw()
	local old_draw_state = {}
	for i = 0x5f00, 0x5f3f do
		add(old_draw_state, peek(i))
		-- poke(i, 0)
		-- TODO set draw state to sensible default
	end

	if old_draw then
		old_draw()
	end
	local cornerX, cornerY = 31, 32-8-1
	poke(0x5f54, 0x60)
	palt(0,false)

	-- TODO
	camera()

	sspr(0,0,128,128, 32,32-8,64,64) 
	palt()

	rectfill(0,0,24,128,0)
	rectfill(128 - 24-1,0,128,128,0)

	draw_header()
	poke(0x5f54, 0x00)

	for i = 0, 7 do
		rect(cornerX-i, cornerY-i, cornerX+i+64, cornerY+i+64,7)
	end

	for i = 0x5f00, 0x5f3f do
		poke(i, old_draw_state[i-0x5f00+1])
		add(old_draw_state, peek(i))
	end
end
-- End Here